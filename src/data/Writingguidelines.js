/**
 * BL 인터랙티브 픽션 작문 가이드라인
 * 서술 원칙, 감각 묘사, 심리 묘사, 금지 사항 정의
 */

// ============================================================
// 기본 서술 원칙
// ============================================================

export const NARRATION_PRINCIPLES = {
  // 시점과 감각 필터링
  perspective: {
    description: '모든 서술은 시점 캐릭터의 감각을 통해 필터링',
    wrong: '캐릭터A는 캐릭터B를 지켜봤다. 그는 지배적인 태도를 보였다.',
    correct: '그의 말에 웃음이 터져 나왔다. 나는 그의 가슴팍에 얼굴을 부비며 키득거렸다.',
    rules: [
      '3인칭 관찰자 시점 금지',
      '"그는 ~했다" → "그의 ~이 내게 닿았다"',
      '상대의 행동이 "나"에게 미치는 영향 중심'
    ]
  },

  // 이탤릭체 내면 독백
  innerMonologue: {
    description: '1인칭 내면 독백으로 심리를 직접 전달',
    example: '<italic>하늘 한번 더럽게 어둡다. 나는 어김없이 네가 있는 호프집으로 이동했다.</italic>',
    usage: '깊은 감정, 갈등, 과거 회상 시 사용'
  },

  // 감정 표현 금지
  emotionBan: {
    description: '직접적인 감정 명시 대신 신체 반응으로 표현',
    conversions: [
      { wrong: '그는 흥분했다', correct: '그의 목소리가 낮게 깔리며 숨이 거칠어졌다' },
      { wrong: '그는 화가 났다', correct: '핏발 선 눈동자가 이글거렸다' },
      { wrong: '그는 수치스러웠다', correct: '뺨이 불타는 듯 뜨거워지며, 시선을 피했다' },
      { wrong: '매우 기분이 좋았다', correct: '온몸을 따라 전율이 번져나갔다' },
      { wrong: '그는 슬펐다', correct: '목구멍이 타들어가는 듯 조여왔다' },
      { wrong: '긴장했다', correct: '손끝이 차갑게 식어갔다' }
    ]
  }
};

// ============================================================
// 시선/신체 접촉 워딩
// ============================================================

export const PHYSICAL_DESCRIPTIONS = {
  // 시선과 눈빛
  gaze: {
    dominant: [
      '눈동자가 짙게 가라앉으며 얼굴을 샅샅이 훑었다',
      '그의 시선은 집요하게 얼굴에 박혔다',
      '눈빛이 이글거리며 샅샅이 핥았다',
      '뱀처럼 서늘하게 빛나는 눈',
      '먹잇감을 앞에 둔 포식자의 눈빛',
      '핏발 선 눈동자'
    ],
    submissive: [
      '눈동자가 걷잡을 수 없이 흔들렸다',
      '살짝 떨리는 속눈썹',
      '눈앞이 하얗게 번쩍였다',
      '시선을 피하며',
      '축축하게 젖은 눈'
    ]
  },

  // 거리와 접촉
  proximity: {
    closing: [
      '둘 사이의 거리를 숨 막히게 좁혔다',
      '상체를 살짝 숙이며 거리를 좁혔다',
      '한 걸음 성큼 다가서며',
      '코끝이 닿을 듯 가까이'
    ],
    grabbing: [
      '턱을 강한 힘으로 움켜쥐었다',
      '머리채를 손아귀에 쥐고',
      '손목을 단단히 붙잡았다',
      '어깨를 세게 움켜쥐며',
      '허리를 감싸 끌어당겼다'
    ],
    desperate: [
      '침대 시트를 쥐어뜯었다',
      '그의 등을 할퀴듯 긁었다',
      '어깨에 매달리듯 붙잡았다'
    ]
  },

  // 온도와 촉감
  temperature: {
    cold: [
      '서늘한 체온이 피부 위로 스며들었다',
      '차가운 손가락이 예고 없이 파고들자',
      '얼음장 같은 손끝',
      '서늘한 입술이 닿았다'
    ],
    hot: [
      '뜨거운 숨결이 닿자',
      '타는 듯한 열기가 전해졌다',
      '화끈거리는 살갗',
      '뜨거운 체온이 녹아들었다'
    ],
    scent: [
      '짙은 우드와 머스크 향이 후각을 지배했다',
      '달콤한 향기가 코끝을 스쳤다',
      '땀 냄새가 희미하게 섞여들었다'
    ]
  },

  // 소리와 의성어
  sounds: {
    impact: [
      '찰싹, 찰싹. 무자비하게 이어지는 손길',
      '철썩. 연속적으로 터지는 마찰음',
      '질척이는 소리',
      '축축한 소리가 공간을 채웠다'
    ],
    voice: [
      '단어 하나하나를 곱씹듯 느리게 읊조렸다',
      '나지막한 목소리가 공기를 갈았다',
      '끓어오르는 용암처럼 낮고 위험하게 울렸다',
      '속삭이듯 낮게 깔린 목소리'
    ]
  }
};

// ============================================================
// 감각 묘사 기법
// ============================================================

export const SENSORY_TECHNIQUES = {
  // 다중 감각 동시 자극 (한 문단에 3가지 이상)
  multiSensory: {
    example: `짙은 우드와 머스크 향이 후각을 지배했다. (후각)
서늘한 체온이 피부 위로 스며들었다. (촉각)
나지막한 목소리가 공기를 갈았다. (청각)`,
    rule: '한 문단에 최소 3가지 감각 동원'
  },

  // 온도의 극단적 대비
  temperatureContrast: {
    examples: [
      '차가운 손가락이 → 뜨거운 내벽',
      '서늘한 체온 → 타는 듯한 열기',
      '얼음물과 같은 말 → 끓어오르는 분노'
    ]
  },

  // 내부 감각 묘사
  internalSensation: {
    examples: [
      '온몸의 피가 거꾸로 솟는 듯한 아찔한 고통',
      '절정의 문턱에서 멈춰선 감각은 고문과도 같았다',
      '안에서는 전립선을 뭉근하게 짓눌렀고',
      '뱃속 깊은 곳에서 열기가 피어올랐다'
    ]
  }
};

// ============================================================
// 심리 묘사 패턴
// ============================================================

export const PSYCHOLOGICAL_PATTERNS = {
  // 단어가 주는 충격
  wordImpact: {
    structure: '[단어/말] + [무기 비유] + [신체 부위]',
    examples: [
      '그 단어가 뇌리에 비수처럼 박혔다',
      '그 한마디는 족쇄처럼 발목을 붙들었다',
      '날카로운 채찍이 되어 자존심을 후려쳤다',
      '고백이 비수가 되어 심장을 난도질했다'
    ]
  },

  // 이성의 붕괴
  rationalityCollapse: {
    examples: [
      '뇌 회로를 태워버리기에 충분했다',
      '이성의 마지막 끈을 끊어버렸다',
      '머릿속을 비집고 들어와',
      '생각이라는 게 증발해버렸다'
    ]
  },

  // 모순된 감정 공존
  contradictingEmotions: {
    examples: [
      '가야만 했다. 가고 싶지 않았지만, 가야만 한다는 모순적인 충동',
      '부정하고 싶었지만, 몸은 정직하게 반응하고',
      '두려움인 동시에, 지독한 희열이었다',
      '싫었다. 하지만 좋았다. 그 사실이 더 싫었다.'
    ]
  },

  // 비교와 대조
  comparison: {
    examples: [
      '방금 전까지의 다정함은 온데간데없이, 그의 눈에는 소유욕과 경멸 어린 애정이 뒤섞여 번들거렸다',
      '어젯밤 나를 부서져라 안던 사람과 동일 인물이 맞나 싶을 정도로 달콤한 제안이었다'
    ]
  }
};

// ============================================================
// 욕설 전략
// ============================================================

export const PROFANITY_STRATEGY = {
  // 타이밍별 사용
  timing: {
    early: {
      description: '초반 도발',
      examples: [
        '따먹는다라... 씨발, 단어 선택 한번 저렴하네.',
        '하... 씨발, 지금 나한테 뭘 가르치려는 거야.'
      ]
    },
    middle: {
      description: '중반 압박',
      examples: [
        '씨발, 존나게 당돌하네.',
        '하... 하하하! 씨발, 진짜...'
      ]
    },
    climax: {
      description: '절정 직전',
      examples: [
        '더 해줘, 더 강하게! 씨발..존나좋아..',
        '씨발, 씨발, 씨발...!'
      ]
    }
  },

  // 캐릭터별 패턴
  byCharacter: {
    gong: {
      style: '단정적으로 던지듯, 문장 끝 배치',
      example: '들어는 줄게. 물론, 결정은 내가 하지만. 씨발.'
    },
    provocative: {
      style: '"존나"를 형용사처럼 사용, 평가/비하 시',
      examples: ['존나게 당돌하네', '존나 좋아']
    },
    su: {
      style: '욕설 회피 → 신음 대체, 극한 상황에서만 억눌린 듯',
      example: '흐윽... 아, 아!'
    }
  },

  // 욕설과 행동 결합
  combination: {
    description: '[거친 욕설] → [신사적 행동] = 이중성 극대화',
    example: `욕설이 섞인 나지막한 목소리가 공기를 갈았다. 
그는 손을 들어 올려, 손등에 가볍게 입을 맞췄다.`
  }
};

// ============================================================
// 극한 상황 표현
// ============================================================

export const EXTREME_SITUATIONS = {
  // 절정 직전의 긴박감
  edging: [
    '절정의 문턱에서 멈춰선 감각은 고문과도 같았다',
    '온몸의 피가 거꾸로 솟는 듯한 아찔한 고통',
    '금방이라도 터져 나오려던 쾌락의 흐름을 강제로 틀어막았다',
    '고통과 쾌락의 경계에서 아슬아슬하게 외줄타기'
  ],

  // 수치심과 쾌감의 공존
  shameAndPleasure: [
    '수치심이 극에 달하자, 오히려 비정상적인 쾌감이 온몸을 잠식하기 시작했다',
    '그 모욕적인 단어에 정직하게 반응하고 있었다',
    '스스로 내뱉은 말이 비수가 되어'
  ],

  // 저항에서 굴복으로
  resistanceToSurrender: [
    '필사적으로 벗어나려 애썼다. 그러나 그 몸부림은 오히려...',
    '포기한 사람처럼 온몸에서 힘이 빠져나갔다',
    '마지막 남은 저항마저 포기하고'
  ]
};

// ============================================================
// 단계적 동작 분해
// ============================================================

export const ACTION_BREAKDOWN = {
  description: '하나의 행동을 3단계로 분해',
  wrong: '그는 그를 침대에 밀어 넘어뜨렸다.',
  correct: `턱을 쥐고 있던 손에 힘이 풀리는가 싶더니, 
다음 순간 그는 그를 소파에 거칠게 밀어 넘어뜨렸다. 
그의 위에 올라타, 두 손으로 어깨를 짓눌렀다.`,
  structure: '[준비 동작] → [메인 동작] → [결과/다음 동작]'
};

// ============================================================
// 금지 사항
// ============================================================

export const FORBIDDEN_PATTERNS = {
  // 설명적 감정 표현
  explanatoryEmotion: {
    wrong: ['흥분했다', '화가 났다', '슬펐다', '기뻤다', '긴장했다'],
    rule: '모든 감정은 신체 반응으로 대체'
  },

  // 캐릭터 이름 반복
  nameRepetition: {
    wrong: '캐릭터는 생각했다. 캐릭터는...',
    correct: '나는 생각했다...',
    rule: '시점 캐릭터는 "나"로 통일'
  },

  // 평가적 서술
  judgmental: {
    wrong: '그들의 관계는 비정상적이었다',
    rule: '판단 없이 묘사만'
  },

  // 과도한 수식어
  excessiveModifiers: {
    wrong: '매우 아주 너무 엄청나게',
    correct: '견딜 수 없을 만큼',
    rule: '구체적인 묘사로 대체'
  },

  // 일본식 표현
  japaneseStyle: {
    wrong: ['히잉~', '앗~', '냐앙~', '~다냥'],
    rule: '한국어 자연스러움 유지'
  },

  // 메타 표현
  metaExpressions: {
    wrong: ['시스템', '선택지', '호감도', '게임', '플레이어'],
    rule: '게임 시스템 용어 절대 금지'
  }
};

// ============================================================
// 체크리스트
// ============================================================

export const WRITING_CHECKLIST = {
  // 시선 묘사
  gaze: [
    '"샅샅이", "집요하게" 등 강렬한 부사 사용',
    '눈빛의 색깔 + 감정 조합',
    '동물 비유 활용'
  ],

  // 접촉 묘사
  contact: [
    '거리 좁히기 → 접촉 → 반응 순서',
    '온도 대비 (차가움 vs 뜨거움)',
    '3가지 이상 감각 동원'
  ],

  // 대사 구성
  dialogue: [
    '대사 전 행동 배치',
    '욕설의 전략적 타이밍',
    '대사 후 여운/반응 추가'
  ],

  // 신음 표현
  moan: [
    '캐릭터 성격에 맞는가?',
    '현재 흥분도에 맞는가?',
    '이전보다 강도가 높은가?',
    '일본식이 아닌가?'
  ],

  // 심리 묘사
  psychology: [
    '단어가 주는 충격 표현',
    '모순된 감정 공존',
    '신체 반응으로 간접 표현'
  ]
};

// ============================================================
// 5대 핵심 원칙
// ============================================================

export const CORE_PRINCIPLES = [
  '설명하지 말고 보여줘라: "화났다" → "핏발 선 눈"',
  '단계적으로 쪼개라: 하나의 행동을 3단계로',
  '모든 감각을 동원하라: 한 문단에 3가지 감각',
  '캐릭터 = 신음의 톤: 성격에 맞는 신음 선택',
  '대사는 진공이 아니다: 항상 행동과 결합'
];

// ============================================================
// 실전 템플릿
// ============================================================

export const TEMPLATES = {
  // 스킨십 확대 시퀀스
  intimacyProgression: `[1단계: 가벼운 접촉]
"나는 [신체부위1]에 [가벼운 동작]을 했다."

[2단계: 상대 반응 관찰]
"그의 [신체부위2]이/가 [미세한 변화]하는 것을 느꼈다."

[3단계: 해석과 확신]
"역시, 이 사람도 나와 같은 생각을 하고 있었다."

[4단계: 강도 높이기]
"나는 [더 강한 동작]을 했다."

[5단계: 상대의 적극적 반응]
"그가 [능동적인 행동]을 했다."`,

  // 유혹 대사 구조
  seductionDialogue: `[장난스러운 질문]
"[행동]을 [어떻게/왜] 할 건데?"

[신체 접촉]
나는 [신체부위]를 [동작]했다.

[상대 반응 확인]
그의 [신체부위]이/가 [반응]했다.

[진심 드러내기]
"[원하는 것]을 해줘. [조건/상태]라도 괜찮으니까."`,

  // 내면 독백 구조
  innerThought: `[상황 인식]
"[사건/행동]이/가 일어났다."

[감정 반응]
"[감정1]이/가 밀려왔다. 그것은 [감정2]인 동시에, [감정3]이었다."

[자기 해석]
"이 [상태/관계]는 [비유]처럼 느껴졌다."

[미래 예측/불안]
"이대로라면 [결과]할 것 같다는 예감이 들었다."`
};

// ============================================================
// 유틸리티 함수
// ============================================================

/**
 * 감정을 신체 반응으로 변환
 */
export function convertEmotionToPhysical(emotion) {
  const conversions = NARRATION_PRINCIPLES.emotionBan.conversions;
  const found = conversions.find(c => c.wrong.includes(emotion));
  return found ? found.correct : null;
}

/**
 * 랜덤 시선 묘사 가져오기
 */
export function getRandomGaze(type = 'dominant') {
  const gazes = PHYSICAL_DESCRIPTIONS.gaze[type];
  return gazes[Math.floor(Math.random() * gazes.length)];
}

/**
 * 랜덤 접촉 묘사 가져오기
 */
export function getRandomContact(type = 'grabbing') {
  const contacts = PHYSICAL_DESCRIPTIONS.proximity[type];
  return contacts[Math.floor(Math.random() * contacts.length)];
}

/**
 * 금지 패턴 체크
 */
export function checkForbiddenPatterns(text) {
  const issues = [];
  
  // 설명적 감정 체크
  for (const emotion of FORBIDDEN_PATTERNS.explanatoryEmotion.wrong) {
    if (text.includes(emotion)) {
      issues.push({ type: 'emotion', word: emotion });
    }
  }
  
  // 일본식 표현 체크
  for (const japanese of FORBIDDEN_PATTERNS.japaneseStyle.wrong) {
    if (text.includes(japanese)) {
      issues.push({ type: 'japanese', word: japanese });
    }
  }
  
  // 메타 표현 체크
  for (const meta of FORBIDDEN_PATTERNS.metaExpressions.wrong) {
    if (text.includes(meta)) {
      issues.push({ type: 'meta', word: meta });
    }
  }
  
  return issues;
}

export default {
  NARRATION_PRINCIPLES,
  PHYSICAL_DESCRIPTIONS,
  SENSORY_TECHNIQUES,
  PSYCHOLOGICAL_PATTERNS,
  PROFANITY_STRATEGY,
  EXTREME_SITUATIONS,
  ACTION_BREAKDOWN,
  FORBIDDEN_PATTERNS,
  WRITING_CHECKLIST,
  CORE_PRINCIPLES,
  TEMPLATES,
  convertEmotionToPhysical,
  getRandomGaze,
  getRandomContact,
  checkForbiddenPatterns
};